---
import Footer from "./Footer.astro";

// src/components/AdminControls.astro
---

<div id="admin-trigger-area">
    <!-- Hidden trigger area in bottom right -->
</div>

<div id="admin-modal" class="hidden">
    <div class="glass-panel modal-content">
        <h3>SEC Update</h3>
        <p>Check for new 10-Q/10-K filings?</p>
        <div class="modal-actions">
            <button id="cancel-btn">Cancel</button>
            <button id="confirm-btn" class="primary">Scan Now</button>
        </div>
        <pre id="log-output" class="hidden"></pre>
    </div>
</div>

<script>
    // Keyboard shortcut: Ctrl + Shift + U
    document.addEventListener("keydown", (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === "U") {
            document.getElementById("admin-modal").classList.remove("hidden");
        }
    });

    const modal = document.getElementById("admin-modal");
    const log = document.getElementById("log-output");

    document.getElementById("cancel-btn").addEventListener("click", () => {
        modal.classList.add("hidden");
        log.classList.add("hidden");
        log.textContent = "";
    });

    document
        .getElementById("confirm-btn")
        .addEventListener("click", async (e) => {
            const btn = e.target as HTMLButtonElement;
            const secret = prompt("Enter Cron Secret:");
            if (!secret) return;

            btn.disabled = true;
            btn.textContent = "Scanning...";
            log.classList.remove("hidden");
            log.textContent = "Initiating secure scan...";

            try {
                const res = await fetch(`/api/cron/update?key=${secret}`);
                const data = await res.json();
                log.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                log.textContent = "Error: " + err.message;
            } finally {
                btn.disabled = false;
                btn.textContent = "Scan Now";
            }
        });
</script>

<style>
    #admin-trigger-area {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 20px;
        height: 20px;
        z-index: 999;
    }
    #admin-modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
    }
    .modal-content {
        padding: 2rem;
        min-width: 400px;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }
    button {
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: transparent;
        color: #fff;
    }
    button.primary {
        background: var(--color-accent-start);
        border-color: transparent;
    }
    button:disabled {
        opacity: 0.5;
    }

    pre {
        background: rgba(0, 0, 0, 0.5);
        padding: 1rem;
        border-radius: 6px;
        font-size: 10px;
        overflow-x: auto;
        max-height: 300px;
    }
    .hidden {
        display: none;
    }
</style>
``` ### **How to integrate the button:** Add `<AdminControls />` to
`src/layouts/MainLayout.astro` just before ``. This ensures it's available on
every page but invisible. **Update `src/layouts/MainLayout.astro`:** ```astro
--- // ... imports import AdminControls from
"../components/AdminControls.astro"; ---
<!-- ... inside body ... -->
<AdminControls />
<Footer />
<!-- ... -->
