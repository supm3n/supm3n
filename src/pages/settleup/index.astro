---
// src/pages/settleup/index.astro
import MainLayout from '../../layouts/MainLayout.astro';
// Import the external CSS
import '../../styles/settleup.css';
---

<MainLayout title="Settle Up (Ephemeral)">
    <main class="app-main">
      <div class="app-header">
        <div class="header-brand">
          <h1 class="app-title">Settle Up (Ephemeral)</h1>
        </div>
        <p class="header-note">No data is saved.</p>
      </div>

      <section id="people-section" class="panel" aria-labelledby="people-title">
        <div class="panel-header">
          <h2 id="people-title">People</h2>
          <button type="button" id="add-person-btn" class="primary">
            Add Guest
          </button>
        </div>
        <ul id="people-list" class="people-list" aria-live="polite"></ul>
      </section>

      <section id="expenses-section" class="panel" aria-labelledby="expense-title">
        <h2 id="expense-title">Expense Form</h2>
        <form id="expense-form" novalidate>
          <div class="form-grid-2">
            <div class="form-row">
              <label for="expense-payer">Paid by</label>
              <select id="expense-payer" required></select>
            </div>
            <div class="form-row">
              <label for="expense-amount">Amount</label>
              <input
                id="expense-amount"
                name="amount"
                inputmode="decimal"
                pattern="^[0-9]+([.,][0-9]{1,2})?$"
                placeholder="0,00"
                required
                autocomplete="off"
                aria-describedby="expense-feedback"
                enterkeyhint="done"
              />
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="primary" id="submit-expense-btn">
              Add Expense
            </button>
            <button type="button" id="cancel-edit-btn" class="secondary" hidden>
              Cancel
            </button>
          </div>
          <p id="expense-feedback" class="form-feedback" aria-live="polite"></p>
        </form>

        <div class="table-wrapper" aria-live="polite">
          <table id="expenses-table">
            <caption>Expenses</caption>
            <thead>
              <tr>
                <th scope="col">Payer</th>
                <th scope="col">Amount</th>
                <th scope="col" class="actions">Actions</th>
              </tr>
            </thead>
            <tbody id="expenses-tbody"></tbody>
          </table>
        </div>
      </section>

      <section id="balances-section" class="panel" aria-labelledby="balances-title">
        <h2 id="balances-title">Balances</h2>
        <ul id="balances-list" class="balances-list" aria-live="polite"></ul>
      </section>

      <section id="settlement-section" class="panel settlement-section" aria-labelledby="settlement-title">
        <h2 id="settlement-title">Settlement</h2>
        <div class="settlement-bar">
          <div class="total-summary">
            <span>Total recorded</span>
            <strong id="total-amount">â‚¬0,00</strong>
          </div>
          <button type="button" id="compute-btn" class="primary large">
            Compute Transfers
          </button>
        </div>
        <div id="settlement-results" class="settlement-results" aria-live="polite" role="status">
          Tap Compute to see who should pay whom.
        </div>
      </section>
    </main>

    <script>
        import { init } from '../../scripts/settleUp.js';
        // Run init when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</MainLayout>